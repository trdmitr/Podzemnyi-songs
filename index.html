<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–†–µ–ø–µ—Ä—Ç—É–∞—Ä –í–∏—Ç–∞–ª–∏—è –ü–æ–¥–∑–µ–º–Ω–æ–≥–æ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.5;
      color: #333;
      background-color: #fafafa;
      padding: 16px;
    }
    header {
      text-align: center;
      margin-bottom: 24px;
      padding: 16px 0;
    }
    h1 {
      font-weight: 700;
      font-size: 1.8rem;
      color: #1a56db;
    }
    .meta {
      font-size: 0.9rem;
      color: #666;
      margin-top: 8px;
    }

    /* === –î–û–ë–ê–í–õ–ï–ù–û: –ª–æ–∞–¥–µ—Ä –∏ –ø–æ–∏—Å–∫ === */
    #loader {
      text-align: center;
      padding: 60px 20px;
      font-size: 1.2rem;
      color: #666;
    }
    #loader.spinner::after {
      content: '';
      display: inline-block;
      width: 24px;
      height: 24px;
      margin-left: 12px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #1a56db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    #search-group {
      width: 100%;
      max-width: 500px;
      padding: 10px 16px;
      margin: 0 auto 24px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      display: block;
    }

    #suggestions {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 500px;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 6px 6px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      list-style: none;
      display: none;
    }
    #suggestions li {
      padding: 8px 16px;
      cursor: pointer;
    }
    #suggestions li:hover {
      background: #f1f5f9;
    }
    /* === –∫–æ–Ω–µ—Ü –¥–æ–±–∞–≤–ª–µ–Ω–∏–π === */

    /* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω */
    .accordion {
      margin-bottom: 16px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .accordion-header {
      background: #f0f0f0;
      padding: 16px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .accordion-header::after {
      content: '‚ñ∏';
      font-size: 1.2rem;
    }
    .accordion-header.active::after {
      content: '‚ñæ';
    }
    .accordion-body {
      background: white;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .accordion-body.active {
      max-height: none !important;
    }
    .song {
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
    }
    .song:last-child {
      border-bottom: none;
    }

    footer {
      text-align: center;
      font-size: 0.85rem;
      color: #777;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid #eee;
    }
    .copy-btn {
  margin-left: 8px;
  padding: 2px 6px;
  font-size: 0.8rem;
  background: #e5e7eb;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  opacity: 0.7;
}
.copy-btn:hover {
  opacity: 1;
  background: #d1d5db;
}
  </style>
</head>
<body>
  <header>
    <h1>–†–µ–ø–µ—Ä—Ç—É–∞—Ä –í–∏—Ç–∞–ª–∏—è –ü–æ–¥–∑–µ–º–Ω–æ–≥–æ</h1>
    <div class="meta">–ö–∞–≤–µ—Ä—ã —Ä—É—Å—Å–∫–æ–≥–æ —Ä–æ–∫–∞ ‚Ä¢ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
    <!-- === –î–û–ë–ê–í–õ–ï–ù–û: –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ === -->
    <div style="position: relative; width: 100%; max-width: 500px; margin: 0 auto;">
      <input type="text" id="search-group" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é" autocomplete="off" />
      <ul id="suggestions"></ul>
    </div>
    <!-- === –∫–æ–Ω–µ—Ü === -->
  </header>

  <!-- === –î–û–ë–ê–í–õ–ï–ù–û: –ª–æ–∞–¥–µ—Ä === -->
  <div id="loader" class="spinner">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä–∞‚Ä¶</div>
  <!-- === –∫–æ–Ω–µ—Ü === -->

  <main id="accordion-container" style="display: none;"></main>

  <footer>
    –î–∞–Ω–Ω—ã–µ –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã ‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="update-time"></span>
  </footer>

  <script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQSG-0QXXOog8H7EFyAMIA-XBh0JFM_e9X-EOkpBzhg5XszVoMbHbDoEAYFLLtCiA/pub?output=csv';

    const loaderEl = document.getElementById('loader');
    const container = document.getElementById('accordion-container');
    const updateTimeEl = document.getElementById('update-time');
    const searchInput = document.getElementById('search-group');
    const suggestionsEl = document.getElementById('suggestions');

    let allGroups = []; // [{name: '–ö–∏–Ω–æ', songs: [...]}]

    // === –î–û–ë–ê–í–õ–ï–ù–û: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∞–¥–µ—Ä–æ–º ===
    function showLoader() {
      loaderEl.style.display = 'block';
      container.style.display = 'none';
    }
    function hideLoader() {
      loaderEl.style.display = 'none';
      container.style.display = 'block';
    }
    // === –∫–æ–Ω–µ—Ü ===

    // === –î–û–ë–ê–í–õ–ï–ù–û: –ø–æ–∏—Å–∫ –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ===
    function filterGroups(query) {
      query = query.trim().toLowerCase();
      const filtered = query
        ? allGroups.filter(g => g.name.toLowerCase().includes(query))
        : allGroups;

      renderGroups(filtered);
    }

    function showSuggestions(items) {
      if (items.length === 0) {
        suggestionsEl.style.display = 'none';
        return;
      }
      suggestionsEl.innerHTML = items.map(g =>
        `<li onclick="fillSearch('${escapeHtml(g.name)}')">${escapeHtml(g.name)}</li>`
      ).join('');
      suggestionsEl.style.display = 'block';
    }

    function hideSuggestions() {
      suggestionsEl.style.display = 'none';
    }

    window.fillSearch = function(text) {
      searchInput.value = text;
      filterGroups(text);
      hideSuggestions();
      searchInput.focus();
    };
    // === –∫–æ–Ω–µ—Ü ===

    function renderGroups(groups) {
      container.innerHTML = groups.map((group, idx) => `
        <div class="accordion">
          <div class="accordion-header" onclick="toggleAccordion(this)">
            ${escapeHtml(group.name)} (${group.songs.length})
          </div>
          <div class="accordion-body">
           ${group.songs.map(song => 
  `<div class="song">
     ${escapeHtml(song)}
     <button class="copy-btn" onclick="copyToClipboard('${escapeHtml(song)}')">üìã</button>
   </div>`
).join('')}
          </div>
        </div>
      `).join('');
    }
    function copyToClipboard(text) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).then(() => {
      alert(`‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ${text}`);
    });
  } else {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    alert(`‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ${text}`);
  }
}

// –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è onclick
window.copyToClipboard = copyToClipboard;
    function toggleAccordion(header) {
      const body = header.nextElementSibling;
      header.classList.toggle('active');
      body.classList.toggle('active');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // === –ó–ê–ì–†–£–ó–ö–ê ===
    showLoader();

    Papa.parse(CSV_URL, {
      download: true,
      header: false,
      skipEmptyLines: true,
      complete: function(results) {
        let data = results.data.filter(row => row.length > 0 && row[0] && row[0].trim() !== '');

        if (data.length === 0) {
          container.innerHTML = '<div class="accordion"><div class="accordion-header">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div></div>';
          hideLoader();
          return;
        }

        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ ‚Äî –ù–ï –ú–ï–ù–Ø–ï–ú –ª–æ–≥–∏–∫—É!
        const groups = [];
        let currentGroup = { name: '', songs: [] };

        data.forEach(row => {
          const item = row[0].trim();
          if (item.startsWith('[–ì–†–£–ü–ü–ê]')) {
            if (currentGroup.name) groups.push(currentGroup);
            currentGroup = { name: item.replace('[–ì–†–£–ü–ü–ê]', '').trim(), songs: [] };
          } else {
            currentGroup.songs.push(item);
          }
        });
        if (currentGroup.name) groups.push(currentGroup);

        allGroups = groups;
        renderGroups(groups);

        const now = new Date();
        updateTimeEl.textContent = now.toLocaleString('ru-RU');

        hideLoader();
      },
      error: function(err) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV:', err);
        container.innerHTML = `<div class="accordion"><div class="accordion-header" style="color:red">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div></div>`;
        hideLoader();
      }
    });

    // === –î–û–ë–ê–í–õ–ï–ù–û: —Å–ª—É—à–∞—Ç–µ–ª–∏ ===
    searchInput.addEventListener('input', () => {
      const q = searchInput.value;
      filterGroups(q);
      if (q.trim()) {
        const matches = allGroups
          .filter(g => g.name.toLowerCase().includes(q.toLowerCase()))
          .slice(0, 6);
        showSuggestions(matches);
      } else {
        hideSuggestions();
      }
    });

    document.addEventListener('click', (e) => {
      if (!e.target.closest('header')) hideSuggestions();
    });
    // === –∫–æ–Ω–µ—Ü ===
  </script>
</body>
</html>